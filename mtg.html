<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTG Card Inventory Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Beleren', 'Trebuchet MS', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 119, 190, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(181, 0, 0, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: linear-gradient(145deg, #2d2d44 0%, #1a1a2e 100%);
            border-radius: 20px;
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.5),
                inset 0 0 30px rgba(255,215,0,0.05),
                0 0 100px rgba(255,215,0,0.1);
            overflow: hidden;
            border: 3px solid rgba(255, 215, 0, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .header {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 50%, #1a1a2e 100%);
            color: #ffd700;
            padding: 40px 30px;
            text-align: center;
            border-bottom: 3px solid rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '‚ú¶';
            position: absolute;
            font-size: 200px;
            opacity: 0.05;
            top: -50px;
            left: -30px;
            color: #ffd700;
        }
        
        .header::after {
            content: '‚ú¶';
            position: absolute;
            font-size: 200px;
            opacity: 0.05;
            bottom: -50px;
            right: -30px;
            color: #ffd700;
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0.5),
                2px 2px 4px rgba(0,0,0,0.8);
            letter-spacing: 2px;
            position: relative;
        }
        
        .header p {
            color: #b8b8d0;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .mana-symbol {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 5px;
            font-weight: bold;
            line-height: 40px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            font-size: 1.2em;
        }
        
        .white { background: linear-gradient(135deg, #f9faf4, #e8e4d0); color: #333; }
        .blue { background: linear-gradient(135deg, #0e68ab, #0077be); color: white; }
        .black { background: linear-gradient(135deg, #150b00, #2b1d0e); color: white; }
        .red { background: linear-gradient(135deg, #d3202a, #e74c3c); color: white; }
        .green { background: linear-gradient(135deg, #00733e, #27ae60); color: white; }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
            position: relative;
        }
        
        .stat-card {
            background: linear-gradient(145deg, #2d2d44, #1a1a2e);
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            min-width: 140px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.3),
                inset 0 0 20px rgba(255,215,0,0.05);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 6px 20px rgba(255,215,0,0.3),
                inset 0 0 30px rgba(255,215,0,0.1);
            border-color: rgba(255, 215, 0, 0.6);
        }
        
        .stat-number {
            font-size: 2.2em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        
        .stat-label {
            color: #b8b8d0;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .controls {
            padding: 30px;
            background: linear-gradient(145deg, #252538, #1f1f2e);
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
        }
        
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 14px 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            font-size: 16px;
            background: rgba(29, 29, 44, 0.8);
            color: #ffd700;
            transition: all 0.3s ease;
        }
        
        .search-input::placeholder {
            color: rgba(184, 184, 208, 0.5);
        }
        
        .search-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            background: rgba(29, 29, 44, 1);
        }
        
        .btn {
            padding: 12px 25px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a1a2e;
            border-color: #ffd700;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
            background: linear-gradient(135deg, #ffed4e, #ffd700);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #3d3d5c, #2d2d44);
            color: #ffd700;
            border-color: rgba(255, 215, 0, 0.4);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #4d4d6c, #3d3d5c);
            border-color: #ffd700;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00733e, #27ae60);
            color: white;
            border-color: #00733e;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #27ae60, #00733e);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .add-card-section {
            background: linear-gradient(145deg, #2d2d44, #1a1a2e);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: inset 0 0 20px rgba(255,215,0,0.05);
        }
        
        .add-card-section h3 {
            margin-bottom: 15px;
            color: #ffd700;
            font-size: 1.4em;
            text-shadow: 0 0 10px rgba(255,215,0,0.3);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #b8b8d0;
            font-size: 0.9em;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 14px;
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            font-size: 14px;
            background: rgba(29, 29, 44, 0.6);
            color: #ffd700;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(29, 29, 44, 0.9);
            box-shadow: 0 0 10px rgba(255,215,0,0.2);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        .form-group select {
            cursor: pointer;
        }
        
        .form-group option {
            background: #1a1a2e;
            color: #ffd700;
        }
        
        .collection-grid {
            padding: 30px;
            background: linear-gradient(145deg, #1f1f2e, #1a1a2e);
        }
        
        .set-section {
            margin-bottom: 40px;
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            overflow: hidden;
            background: linear-gradient(145deg, #2d2d44, #252538);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .set-header {
            background: linear-gradient(135deg, #3d3d5c, #2d2d44);
            color: #ffd700;
            padding: 20px;
            font-size: 1.3em;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .set-header:hover {
            background: linear-gradient(135deg, #4d4d6c, #3d3d5c);
        }
        
        .set-stats {
            font-size: 0.9em;
            color: #b8b8d0;
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            padding: 20px;
            background: linear-gradient(145deg, #252538, #1f1f2e);
        }
        
        .card-item {
            background: linear-gradient(145deg, #2d2d44, #252538);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 
                0 4px 12px rgba(0,0,0,0.4),
                inset 0 0 15px rgba(255,215,0,0.03);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 215, 0, 0.2);
            position: relative;
        }
        
        .card-item::before {
            content: '‚ú¶';
            position: absolute;
            top: 10px;
            right: 10px;
            color: rgba(255, 215, 0, 0.1);
            font-size: 40px;
        }
        
        .card-item:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(255,215,0,0.2),
                inset 0 0 25px rgba(255,215,0,0.08);
            border-color: rgba(255, 215, 0, 0.5);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .card-name {
            font-weight: bold;
            font-size: 1.15em;
            color: #ffd700;
            flex: 1;
            text-shadow: 0 0 8px rgba(255,215,0,0.3);
        }
        
        .quantity-badge {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a1a2e;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
            box-shadow: 0 2px 8px rgba(255,215,0,0.3);
        }
        
        .rarity-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: bold;
            margin-top: 8px;
            text-transform: uppercase;
        }
        
        .rarity-common { background: #1a1a1a; color: #999; border: 1px solid #333; }
        .rarity-uncommon { background: #2d3e50; color: silver; border: 1px solid silver; }
        .rarity-rare { background: #8b7500; color: gold; border: 1px solid gold; }
        .rarity-mythic { background: #d3202a; color: #ff6b6b; border: 1px solid #ff6b6b; }
        
        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .price-display {
            background: linear-gradient(135deg, rgba(0, 119, 190, 0.2), rgba(0, 119, 190, 0.1));
            padding: 12px;
            border-radius: 10px;
            margin: 12px 0;
            border-left: 4px solid #0077be;
            box-shadow: inset 0 0 10px rgba(0,119,190,0.1);
        }
        
        .price-amount {
            font-weight: bold;
            color: #4da6ff;
            font-size: 1.15em;
            text-shadow: 0 0 8px rgba(77,166,255,0.3);
        }
        
        .loading {
            color: #b8b8d0;
            font-style: italic;
        }
        
        .card-detail {
            margin: 8px 0;
            font-size: 0.95em;
            color: #b8b8d0;
        }
        
        .card-detail strong {
            color: #ffd700;
        }
        
        .notes-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            background: rgba(29, 29, 44, 0.6);
            color: #b8b8d0;
            transition: all 0.3s ease;
        }
        
        .notes-input:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(29, 29, 44, 0.9);
        }
        
        .sold-indicator {
            background: linear-gradient(135deg, #00733e, #27ae60);
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 10px;
            box-shadow: 0 2px 8px rgba(39,174,96,0.3);
        }
        
        .total-value {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #0f3460, #16213e);
            color: #ffd700;
            padding: 18px 28px;
            border-radius: 15px;
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.5),
                0 0 30px rgba(255,215,0,0.2);
            font-weight: bold;
            z-index: 1000;
            border: 2px solid rgba(255, 215, 0, 0.4);
            font-size: 1.1em;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(145deg, #2d2d44, #1a1a2e);
            margin: 5% auto;
            padding: 35px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 20px 60px rgba(0,0,0,0.7);
        }
        
        .modal-content h2 {
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(255,215,0,0.4);
        }
        
        .close {
            color: #b8b8d0;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close:hover {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-bar {
                flex-direction: column;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #ffed4e, #ffd700);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öîÔ∏è MTG Card Vault ‚öîÔ∏è</h1>
            <p>Manage your Magic: The Gathering inventory & maximize value</p>
            <div style="margin: 15px 0;">
                <span class="mana-symbol white">W</span>
                <span class="mana-symbol blue">U</span>
                <span class="mana-symbol black">B</span>
                <span class="mana-symbol red">R</span>
                <span class="mana-symbol green">G</span>
            </div>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalCards">0</div>
                    <div class="stat-label">Total Cards</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalSets">0</div>
                    <div class="stat-label">Sets</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalValue">$0</div>
                    <div class="stat-label">Collection Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalSold">$0</div>
                    <div class="stat-label">Sold Value</div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="add-card-section">
                <h3>‚ûï Add Card to Inventory</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Set Name *</label>
                        <input type="text" id="newSet" placeholder="e.g., Wilds of Eldraine" list="sets-list">
                        <datalist id="sets-list">
                            <option value="Wilds of Eldraine">
                            <option value="Lost Caverns of Ixalan">
                            <option value="Murders at Karlov Manor">
                            <option value="Modern Horizons 3">
                            <option value="Bloomburrow">
                            <option value="Duskmourn">
                            <option value="Foundations">
                            <option value="Commander Masters">
                            <option value="The Brothers' War">
                            <option value="Dominaria United">
                        </datalist>
                    </div>
                    <div class="form-group">
                        <label>Card Name *</label>
                        <input type="text" id="newCardName" placeholder="e.g., Sheoldred, the Apocalypse">
                    </div>
                    <div class="form-group">
                        <label>Collector Number</label>
                        <input type="text" id="newCollectorNum" placeholder="e.g., 107">
                    </div>
                    <div class="form-group">
                        <label>Quantity *</label>
                        <input type="number" id="newQuantity" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label>Rarity</label>
                        <select id="newRarity">
                            <option value="">Select Rarity</option>
                            <option value="common">Common</option>
                            <option value="uncommon">Uncommon</option>
                            <option value="rare">Rare</option>
                            <option value="mythic">Mythic Rare</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Finish</label>
                        <select id="newFinish">
                            <option value="nonfoil">Non-Foil</option>
                            <option value="foil">Foil</option>
                            <option value="etched">Etched Foil</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Purchase Price</label>
                        <input type="number" id="newPurchasePrice" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Target Sell Price</label>
                        <input type="number" id="newSellPrice" step="0.01" placeholder="0.00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Condition & Notes</label>
                    <textarea id="newNotes" placeholder="NM, LP, MP, HP, DMG - Include any defects or special features"></textarea>
                </div>
                <button class="btn btn-success" onclick="addNewCard()">‚ûï Add Card to Vault</button>
            </div>
            
            <div class="search-bar">
                <input type="text" class="search-input" id="searchInput" placeholder="Search by card name, set, or collector number...">
                <button class="btn btn-primary" onclick="searchInventory()">üîç Search</button>
                <button class="btn btn-secondary" onclick="showAllCards()">üìã Show All</button>
            </div>
            <div class="filters">
                <button class="btn btn-secondary btn-small" onclick="showHighValue()">üíé $20+ Cards</button>
                <button class="btn btn-secondary btn-small" onclick="showMythicsRares()">‚≠ê Mythics & Rares</button>
                <button class="btn btn-secondary btn-small" onclick="showNeedsPricing()">‚ùì Needs Pricing</button>
                <button class="btn btn-secondary btn-small" onclick="showFoils()">‚ú® Foils Only</button>
                <button class="btn btn-secondary btn-small" onclick="showUnsold()">üì¶ Available</button>
                <button class="btn btn-secondary btn-small" onclick="showSoldCards()">‚úÖ Sold</button>
                <button class="btn btn-secondary btn-small" onclick="exportCSV()">üìä Export CSV</button>
                <button class="btn btn-secondary btn-small" onclick="generateListings()">üìù Generate Listings</button>
                <button class="btn btn-secondary btn-small" onclick="clearAll()" style="background: linear-gradient(135deg, #d3202a, #e74c3c); border-color: #d3202a;">üóëÔ∏è Clear All</button>
            </div>
        </div>
        
        <div class="collection-grid" id="inventoryGrid">
            <div style="text-align: center; padding: 40px; color: #b8b8d0;">
                <h3 style="color: #ffd700;">Your vault is empty</h3>
                <p>Start adding cards to build your collection!</p>
            </div>
        </div>
    </div>
    
    <div class="total-value" id="totalValueDisplay">
        Collection Value: $0.00
    </div>

    <!-- Modal for card details -->
    <div id="cardModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        let inventory = {};
        let cardData = {};

        // Initialize the application
        function initializeApp() {
            loadStoredData();
            renderInventory();
            updateStats();
        }

        // Load stored data from localStorage
        function loadStoredData() {
            const storedInventory = localStorage.getItem('mtg-inventory');
            const storedData = localStorage.getItem('mtg-card-data');
            
            if (storedInventory) {
                inventory = JSON.parse(storedInventory);
            }
            if (storedData) {
                cardData = JSON.parse(storedData);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('mtg-inventory', JSON.stringify(inventory));
            localStorage.setItem('mtg-card-data', JSON.stringify(cardData));
        }

        // Add new card to inventory
        function addNewCard() {
            const setName = document.getElementById('newSet').value.trim();
            const cardName = document.getElementById('newCardName').value.trim();
            const collectorNum = document.getElementById('newCollectorNum').value.trim() || generateId();
            const quantity = parseInt(document.getElementById('newQuantity').value) || 1;
            const rarity = document.getElementById('newRarity').value;
            const finish = document.getElementById('newFinish').value;
            const purchasePrice = parseFloat(document.getElementById('newPurchasePrice').value) || 0;
            const sellPrice = parseFloat(document.getElementById('newSellPrice').value) || 0;
            const notes = document.getElementById('newNotes').value.trim();

            if (!setName || !cardName) {
                alert('Please fill in Set Name and Card Name');
                return;
            }

            // Initialize set if it doesn't exist
            if (!inventory[setName]) {
                inventory[setName] = [];
            }

            // Add card to inventory
            const card = {
                id: collectorNum,
                name: cardName,
                quantity: quantity
            };

            inventory[setName].push(card);

            // Add card data
            const key = `${setName}-${collectorNum}`;
            cardData[key] = {
                rarity: rarity,
                finish: finish,
                purchasePrice: purchasePrice,
                price: sellPrice,
                notes: notes,
                dateAdded: new Date().toISOString()
            };

            saveData();
            renderInventory();
            updateStats();

            // Clear form
            document.getElementById('newSet').value = '';
            document.getElementById('newCardName').value = '';
            document.getElementById('newCollectorNum').value = '';
            document.getElementById('newQuantity').value = '1';
            document.getElementById('newRarity').value = '';
            document.getElementById('newFinish').value = 'nonfoil';
            document.getElementById('newPurchasePrice').value = '';
            document.getElementById('newSellPrice').value = '';
            document.getElementById('newNotes').value = '';

            showNotification('‚úÖ Card added to vault!', 'success');
        }

        // Generate unique ID
        function generateId() {
            return 'CARD' + Date.now().toString(36);
        }

        // Render entire inventory
        function renderInventory(filteredData = null) {
            const container = document.getElementById('inventoryGrid');
            const data = filteredData || inventory;
            container.innerHTML = '';

            if (Object.keys(data).length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #b8b8d0;">
                        <h3 style="color: #ffd700;">No cards to display</h3>
                        <p>Add cards using the form above or adjust your filters</p>
                    </div>
                `;
                return;
            }

            Object.entries(data).forEach(([setName, cards]) => {
                const setDiv = document.createElement('div');
                setDiv.className = 'set-section';
                
                const totalCards = cards.reduce((sum, card) => sum + card.quantity, 0);
                const setValue = cards.reduce((sum, card) => {
                    const key = `${setName}-${card.id}`;
                    const price = cardData[key]?.price || 0;
                    return sum + (price * card.quantity);
                }, 0);

                setDiv.innerHTML = `
                    <div class="set-header" onclick="toggleSet(this)">
                        <span>‚ú¶ ${setName}</span>
                        <div class="set-stats">
                            ${totalCards} cards | $${setValue.toFixed(2)}
                        </div>
                    </div>
                    <div class="cards-grid" id="set-${setName.replace(/\s+/g, '-')}">
                    </div>
                `;
                
                container.appendChild(setDiv);
                
                const cardsGrid = setDiv.querySelector('.cards-grid');
                cards.forEach(card => {
                    const cardElement = createCardElement(setName, card);
                    cardsGrid.appendChild(cardElement);
                });
            });
        }

        // Toggle set visibility
        function toggleSet(header) {
            const grid = header.nextElementSibling;
            grid.style.display = grid.style.display === 'none' ? 'grid' : 'none';
        }

        // Create card element
        function createCardElement(setName, card) {
            const key = `${setName}-${card.id}`;
            const data = cardData[key] || {};
            
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card-item';
            
            const profit = data.price && data.purchasePrice ? 
                (data.price - data.purchasePrice) * card.quantity : 0;
            const profitPercent = data.purchasePrice && data.price ?
                ((data.price - data.purchasePrice) / data.purchasePrice * 100).toFixed(1) : 0;
            
            const rarityClass = data.rarity ? `rarity-${data.rarity}` : '';
            const finishText = data.finish === 'foil' ? '‚ú® Foil' : data.finish === 'etched' ? '‚ú¶ Etched' : '';
            
            cardDiv.innerHTML = `
                <div class="card-header">
                    <div class="card-name">${card.name}</div>
                    <div class="quantity-badge">√ó${card.quantity}</div>
                    ${data.sold ? '<span class="sold-indicator">SOLD</span>' : ''}
                </div>
                
                <div class="card-detail"><strong>Set:</strong> ${setName}</div>
                <div class="card-detail"><strong>Collector #:</strong> ${card.id}</div>
                ${data.rarity ? `<span class="rarity-badge ${rarityClass}">${data.rarity}</span>` : ''}
                ${finishText ? `<div class="card-detail">${finishText}</div>` : ''}
                
                <div class="price-display" id="price-${key}">
                    ${data.price ? 
                        `<div class="price-amount">Sell: $${data.price.toFixed(2)} each</div>
                         ${data.purchasePrice ? `<div style="font-size: 0.9em; color: #b8b8d0;">Cost: $${data.purchasePrice.toFixed(2)} | Profit: $${profit.toFixed(2)} (${profitPercent}%)</div>` : ''}
                         <div style="margin-top: 5px;">Total: $${(data.price * card.quantity).toFixed(2)}</div>` 
                        : '<div class="loading">Price not set</div>'
                    }
                </div>
                
                ${data.notes ? `<div class="card-detail"><strong>Notes:</strong> ${data.notes}</div>` : ''}
                
                <div class="card-actions">
                    <button class="btn btn-primary btn-small" onclick="checkMarketPrice('${key}', '${setName}', '${card.name}')">
                        üí∞ Check Price
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="editCard('${key}', '${setName}')">
                        ‚úèÔ∏è Edit
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="toggleSold('${key}')">
                        ${data.sold ? 'üì¶ Unsold' : '‚úÖ Sold'}
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="deleteCard('${key}', '${setName}', '${card.id}')">
                        üóëÔ∏è Delete
                    </button>
                </div>
            `;
            
            return cardDiv;
        }

        // Check market prices
        function checkMarketPrice(key, setName, cardName) {
            const data = cardData[key] || {};
            const finish = data.finish === 'foil' ? ' foil' : '';
            const searchTerm = `${cardName}${finish} ${setName}`;
            
            // Open eBay sold listings
            const ebayUrl = `https://www.ebay.com/sch/i.html?_nkw=${encodeURIComponent(searchTerm + ' MTG')}&_sacat=0&LH_Sold=1&LH_Complete=1&_sop=13`;
            window.open(ebayUrl, '_blank');
            
            // Open TCGPlayer
            const tcgUrl = `https://www.tcgplayer.com/search/magic/product?q=${encodeURIComponent(cardName)}`;
            setTimeout(() => window.open(tcgUrl, '_blank'), 500);
            
            // Open CardKingdom
            const ckUrl = `https://www.cardkingdom.com/catalog/search?search=header&filter%5Bname%5D=${encodeURIComponent(cardName)}`;
            setTimeout(() => window.open(ckUrl, '_blank'), 1000);
            
            showNotification('üîç Opened eBay, TCGPlayer, and Card Kingdom price checks', 'info');
        }

        // Edit card
        function editCard(key, setName) {
            const [set, id] = key.split('-');
            const card = inventory[setName].find(c => c.id === id);
            const data = cardData[key] || {};
            
            const modalContent = `
                <h2>‚úèÔ∏è Edit Card</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Card Name</label>
                        <input type="text" id="editName" value="${card.name}">
                    </div>
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="editQuantity" value="${card.quantity}" min="1">
                    </div>
                    <div class="form-group">
                        <label>Rarity</label>
                        <select id="editRarity">
                            <option value="">Select Rarity</option>
                            <option value="common" ${data.rarity === 'common' ? 'selected' : ''}>Common</option>
                            <option value="uncommon" ${data.rarity === 'uncommon' ? 'selected' : ''}>Uncommon</option>
                            <option value="rare" ${data.rarity === 'rare' ? 'selected' : ''}>Rare</option>
                            <option value="mythic" ${data.rarity === 'mythic' ? 'selected' : ''}>Mythic Rare</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Finish</label>
                        <select id="editFinish">
                            <option value="nonfoil" ${data.finish === 'nonfoil' ? 'selected' : ''}>Non-Foil</option>
                            <option value="foil" ${data.finish === 'foil' ? 'selected' : ''}>Foil</option>
                            <option value="etched" ${data.finish === 'etched' ? 'selected' : ''}>Etched Foil</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Purchase Price</label>
                        <input type="number" id="editPurchasePrice" value="${data.purchasePrice || ''}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Sell Price</label>
                        <input type="number" id="editSellPrice" value="${data.price || ''}" step="0.01">
                    </div>
                </div>
                <div class="form-group">
                    <label>Condition & Notes</label>
                    <textarea id="editNotes">${data.notes || ''}</textarea>
                </div>
                <button class="btn btn-success" onclick="saveEdit('${key}', '${setName}', '${id}')">üíæ Save Changes</button>
            `;
            
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('cardModal').style.display = 'block';
        }

        // Save edited card
        function saveEdit(key, setName, id) {
            const card = inventory[setName].find(c => c.id === id);
            
            card.name = document.getElementById('editName').value;
            card.quantity = parseInt(document.getElementById('editQuantity').value);
            
            if (!cardData[key]) cardData[key] = {};
            cardData[key].rarity = document.getElementById('editRarity').value;
            cardData[key].finish = document.getElementById('editFinish').value;
            cardData[key].purchasePrice = parseFloat(document.getElementById('editPurchasePrice').value) || 0;
            cardData[key].price = parseFloat(document.getElementById('editSellPrice').value) || 0;
            cardData[key].notes = document.getElementById('editNotes').value;
            
            saveData();
            renderInventory();
            updateStats();
            closeModal();
            showNotification('‚úÖ Card updated!', 'success');
        }

        // Toggle sold status
        function toggleSold(key) {
            if (!cardData[key]) cardData[key] = {};
            cardData[key].sold = !cardData[key].sold;
            
            if (cardData[key].sold) {
                cardData[key].dateSold = new Date().toISOString();
            } else {
                delete cardData[key].dateSold;
            }
            
            saveData();
            renderInventory();
            updateStats();
        }

        // Delete card
        function deleteCard(key, setName, id) {
            if (!confirm('Remove this card from your vault?')) return;
            
            inventory[setName] = inventory[setName].filter(c => c.id !== id);
            
            if (inventory[setName].length === 0) {
                delete inventory[setName];
            }
            
            delete cardData[key];
            
            saveData();
            renderInventory();
            updateStats();
            showNotification('üóëÔ∏è Card removed', 'info');
        }

        // Update statistics
        function updateStats() {
            let totalCards = 0;
            let totalValue = 0;
            let totalSold = 0;

            Object.entries(inventory).forEach(([setName, cards]) => {
                cards.forEach(card => {
                    totalCards += card.quantity;
                    const key = `${setName}-${card.id}`;
                    const data = cardData[key];
                    
                    if (data?.price) {
                        if (data.sold) {
                            totalSold += data.price * card.quantity;
                        } else {
                            totalValue += data.price * card.quantity;
                        }
                    }
                });
            });

            document.getElementById('totalCards').textContent = totalCards;
            document.getElementById('totalSets').textContent = Object.keys(inventory).length;
            document.getElementById('totalValue').textContent = `$${totalValue.toFixed(0)}`;
            document.getElementById('totalSold').textContent = `$${totalSold.toFixed(0)}`;
            document.getElementById('totalValueDisplay').textContent = `Collection Value: $${totalValue.toFixed(2)}`;
        }

        // Search inventory
        function searchInventory() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (!query) {
                renderInventory();
                return;
            }

            const filtered = {};
            Object.entries(inventory).forEach(([setName, cards]) => {
                const matchingCards = cards.filter(card => 
                    card.name.toLowerCase().includes(query) ||
                    setName.toLowerCase().includes(query) ||
                    card.id.toLowerCase().includes(query)
                );
                
                if (matchingCards.length > 0) {
                    filtered[setName] = matchingCards;
                }
            });

            renderInventory(filtered);
        }

        // Show all cards
        function showAllCards() {
            document.getElementById('searchInput').value = '';
            renderInventory();
        }

        // Show high value cards
        function showHighValue() {
            const filtered = {};
            Object.entries(inventory).forEach(([setName, cards]) => {
                const highValueCards = cards.filter(card => {
                    const key = `${setName}-${card.id}`;
                    const data = cardData[key];
                    return data?.price && data.price >= 20;
                });
                
                if (highValueCards.length > 0) {
                    filtered[setName] = highValueCards;
                }
            });

            renderInventory(filtered);
        }

        // Show mythics and rares
        function showMythicsRares() {
            const filtered = {};
            Object.entries(inventory).forEach(([setName, cards]) => {
                const rareCards = cards.filter(card => {
                    const key = `${setName}-${card.id}`;
                    const data = cardData[key];
                    return data?.rarity === 'rare' || data?.rarity === 'mythic';
                });
                
                if (rareCards.length > 0) {
                    filtered[setName] = rareCards;
                }
            });

            renderInventory(filtered);
        }

        // Show cards needing pricing
        function showNeedsPricing() {
            const filtered = {};
            Object.entries(inventory).forEach(([setName, cards]) => {
                const unpricedCards = cards.filter(card => {
                    const key = `${setName}-${card.id}`;
                    const data = cardData[key];
                    return !data?.price;
                });
                
                if (unpricedCards.length > 0) {
                    filtered[setName] = unpricedCards;
                }
            });

            renderInventory(filtered);
        }

        // Show foils only
        function showFoils() {
            const filtered = {};
            Object.entries(inventory).forEach(([setName, cards]) => {
                const foilCards = cards.filter(card => {
                    const key = `${setName}-${card.id}`;
                    const data = cardData[key];
                    return data?.finish === 'foil' || data?.finish === 'etched';
                });
                
                if (foilCards.length > 0) {
                    filtered[setName] = foilCards;
                }
            });

            renderInventory(filtered);
        }

        // Show unsold cards
        function showUnsold() {
            const filtered = {};
            Object.entries(inventory).forEach(([setName, cards]) => {
                const unsoldCards = cards.filter(card => {
                    const key = `${setName}-${card.id}`;
                    const data = cardData[key];
                    return !data?.sold;
                });
                
                if (unsoldCards.length > 0) {
                    filtered[setName] = unsoldCards;
                }
            });

            renderInventory(filtered);
        }

        // Show sold cards
        function showSoldCards() {
            const filtered = {};
            Object.entries(inventory).forEach(([setName, cards]) => {
                const soldCards = cards.filter(card => {
                    const key = `${setName}-${card.id}`;
                    const data = cardData[key];
                    return data?.sold;
                });
                
                if (soldCards.length > 0) {
                    filtered[setName] = soldCards;
                }
            });

            renderInventory(filtered);
        }

        // Export to CSV
        function exportCSV() {
            const csvData = ['Set,Collector Number,Card Name,Quantity,Rarity,Finish,Purchase Price,Sell Price,Profit,Status,Date Added,Date Sold,Condition/Notes'];
            
            Object.entries(inventory).forEach(([setName, cards]) => {
                cards.forEach(card => {
                    const key = `${setName}-${card.id}`;
                    const data = cardData[key] || {};
                    const profit = data.price && data.purchasePrice ? 
                        ((data.price - data.purchasePrice) * card.quantity).toFixed(2) : '0.00';
                    const status = data.sold ? 'Sold' : 'Available';
                    const notes = (data.notes || '').replace(/,/g, ';').replace(/\n/g, ' ');
                    
                    csvData.push(
                        `"${setName}","${card.id}","${card.name}",${card.quantity},"${data.rarity || ''}","${data.finish || 'nonfoil'}",` +
                        `${data.purchasePrice || 0},${data.price || 0},${profit},"${status}",` +
                        `"${data.dateAdded || ''}","${data.dateSold || ''}","${notes}"`
                    );
                });
            });

            const blob = new Blob([csvData.join('\n')], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mtg-inventory-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('üìä CSV exported successfully!', 'success');
        }

        // Generate listings
        function generateListings() {
            let listings = [];
            
            Object.entries(inventory).forEach(([setName, cards]) => {
                cards.forEach(card => {
                    const key = `${setName}-${card.id}`;
                    const data = cardData[key];
                    
                    if (data?.price && data.price >= 5 && !data.sold) {
                        const finishText = data.finish === 'foil' ? ' [FOIL]' : data.finish === 'etched' ? ' [ETCHED]' : '';
                        const rarityText = data.rarity ? ` - ${data.rarity.toUpperCase()}` : '';
                        
                        listings.push({
                            title: `MTG ${card.name}${finishText} - ${setName}${rarityText}`,
                            setName: setName,
                            cardName: card.name,
                            collectorNum: card.id,
                            quantity: card.quantity,
                            price: data.price,
                            rarity: data.rarity || 'N/A',
                            finish: data.finish || 'nonfoil',
                            notes: data.notes || 'No additional notes',
                            total: data.price * card.quantity
                        });
                    }
                });
            });

            listings.sort((a, b) => b.price - a.price);

            const listingDoc = `MTG CARD LISTINGS
Generated: ${new Date().toLocaleDateString()}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

${listings.map((card, index) => `
${index + 1}. ${card.title}

   Set: ${card.setName}
   Collector #: ${card.collectorNum}
   Rarity: ${card.rarity.toUpperCase()}
   Finish: ${card.finish.toUpperCase()}
   Price: $${card.price.toFixed(2)}${card.quantity > 1 ? ` each (${card.quantity} available)` : ''}
   ${card.quantity > 1 ? `Total Value: $${card.total.toFixed(2)}` : ''}
   
   Condition/Notes: ${card.notes}
   
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
`).join('')}

SUMMARY
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Total Listings: ${listings.length}
Total Cards: ${listings.reduce((sum, card) => sum + card.quantity, 0)}
Total Value: $${listings.reduce((sum, card) => sum + card.total, 0).toFixed(2)}

SELLING NOTES
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
- All cards carefully packaged in sleeves/toploaders
- Combined shipping available
- Ships within 1 business day
- Tracking provided on all orders
- Bulk discounts available - message for pricing!
            `.trim();

            const blob = new Blob([listingDoc], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mtg-listings-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification(`üìù Generated ${listings.length} listings!`, 'success');
        }

        // Clear all data
        function clearAll() {
            if (!confirm('‚ö†Ô∏è Delete your entire card vault? This cannot be undone!')) return;
            if (!confirm('Really erase everything? Last chance!')) return;
            
            inventory = {};
            cardData = {};
            saveData();
            renderInventory();
            updateStats();
            showNotification('üóëÔ∏è Vault cleared', 'info');
        }

        // Close modal
        function closeModal() {
            document.getElementById('cardModal').style.display = 'none';
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'linear-gradient(135deg, #00733e, #27ae60)',
                info: 'linear-gradient(135deg, #0077be, #4da6ff)',
                warning: 'linear-gradient(135deg, #ffd700, #ffed4e)',
                error: 'linear-gradient(135deg, #d3202a, #e74c3c)'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1002;
                background: ${colors[type]}; color: white;
                padding: 15px 20px; border-radius: 12px;
                box-shadow: 0 8px 20px rgba(0,0,0,0.4);
                font-weight: bold; max-width: 350px;
                border: 2px solid rgba(255,255,255,0.2);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 3500);
        }

        // Initialize app on load
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Search on Enter key
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchInventory();
            });
        });

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('cardModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
